{"parsed":{"_path":"/2021/package-md-editor-for-rn","_dir":"2021","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"React Native中使用Markdown编辑器","description":"最近在研究React Native，准备用它写一个笔记 APP，但是并没有搜到很好用的编辑器插件，因此准备使用WebView和已有的 Web 端编辑器自己封装一个。","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最近在研究"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"React Native"}]},{"type":"text","value":"，准备用它写一个笔记 APP，但是并没有搜到很好用的编辑器插件，因此准备使用"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"WebView"}]},{"type":"text","value":"和已有的 Web 端编辑器自己封装一个。"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"因本人没有苹果电脑，因此只尝试安卓版本"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"完整项目地址："},{"type":"element","tag":"a","props":{"href":"https://github.com/qiyuor2/rn-xnote","rel":["nofollow"]},"children":[{"type":"text","value":"qiyuor2/rn-xnote"}]}]},{"type":"element","tag":"h2","props":{"id":"react-native-webview"},"children":[{"type":"text","value":"React Native WebView"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"WebView"}]},{"type":"text","value":"是一个能够在原生 APP 上加载 HTML 页面的组件，不过它没有提供浏览器的地址栏、导航栏等功能。在原生 APP 的开发中经常会用到。"}]},{"type":"element","tag":"h3","props":{"id":"安装"},"children":[{"type":"text","value":"安装"}]},{"type":"element","tag":"code","props":{"code":"npm install react-native-webview\n# or yarn add react-native-webview\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"npm install react-native-webview\n# or yarn add react-native-webview\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"基本使用"},"children":[{"type":"text","value":"基本使用"}]},{"type":"element","tag":"h4","props":{"id":"引入-url"},"children":[{"type":"text","value":"引入 URL"}]},{"type":"element","tag":"code","props":{"code":"import React, { Component } from 'react';\nimport { WebView } from 'react-native';\n\nexport default function MyWeb() {\n  return (\n    <WebView source={{ uri: 'https://github.com/facebook/react-native' }} />\n  );\n}\n","language":"jsx"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"import React, { Component } from 'react';\nimport { WebView } from 'react-native';\n\nexport default function MyWeb() {\n  return (\n    <WebView source={{ uri: 'https://github.com/facebook/react-native' }} />\n  );\n}\n"}]}]}]},{"type":"element","tag":"h4","props":{"id":"引入本地文件"},"children":[{"type":"text","value":"引入本地文件"}]},{"type":"element","tag":"code","props":{"code":"import React, { Component } from 'react';\nimport { WebView, Platform } from 'react-native';\n\nexport default function MyWeb() {\n  return (\n    <WebView\n      source={\n        Platform.OS === 'ios'\n          ? require('../../../assets/vditor.html')\n          : { uri: 'file:///android_asset/vditor.html' }\n      }\n    />\n  );\n}\n","language":"jsx"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"import React, { Component } from 'react';\nimport { WebView, Platform } from 'react-native';\n\nexport default function MyWeb() {\n  return (\n    <WebView\n      source={\n        Platform.OS === 'ios'\n          ? require('../../../assets/vditor.html')\n          : { uri: 'file:///android_asset/vditor.html' }\n      }\n    />\n  );\n}\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"web-和-react-native-之间的通信"},"children":[{"type":"text","value":"Web 和 React Native 之间的通信"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Web 到 React Native"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"window.ReactNativeWebView.postMessage(message)"}]},{"type":"text","value":"该方法接收一个字符串，并将该字符串发送到 React Native 中。在 React Native 中使用"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"WebView"}]},{"type":"text","value":"组件的"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"onMessage"}]},{"type":"text","value":"属性接收"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"React Native 到 Web"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"injectedJavaScript"}]},{"type":"text","value":"向网页中注入 js"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"injectedJavaScriptBeforeContentLoaded"}]},{"type":"text","value":"在网页加载之前向网页中注入 js"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"postMessage(message)"}]},{"type":"text","value":"向网页中发送消息，与"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"window.ReactNativeWebView.postMessage(message)"}]},{"type":"text","value":"相对应。网页可以通过监听"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"message"}]},{"type":"text","value":"事件收到消息。"}]}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"更多 API 请查看"},{"type":"element","tag":"a","props":{"href":"https://reactnative.cn/docs/webview","rel":["nofollow"]},"children":[{"type":"text","value":"WebView 文档"}]}]}]},{"type":"element","tag":"h2","props":{"id":"封装-vditor"},"children":[{"type":"text","value":"封装 Vditor"}]},{"type":"element","tag":"h3","props":{"id":"准备-html-文件"},"children":[{"type":"text","value":"准备 HTML 文件"}]},{"type":"element","tag":"code","props":{"code":"<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n    <meta\n      name=\"viewport\"\n      content=\"width=device-width, initial-scale=1.0, user-scalable=no\"\n    />\n    <!-- 以下文件建议放到本地使用 -->\n    <link\n      rel=\"stylesheet\"\n      href=\"https://gcore.jsdelivr.net/npm/vditor/dist/index.css\"\n    />\n    <script src=\"https://gcore.jsdelivr.net/npm/vditor/dist/index.min.js\"></script>\n  </head>\n  <body>\n    <div id=\"vditor\"></div>\n    <script>\n      // window.options 会在React Native中通过injectedJavaScriptBeforeContentLoaded注入\n      const vditor = new Vditor('vditor', {\n        ...window.options,\n        // 向编辑器输入时，通过postMessage向React Native发送消息，触发onMessage\n        input: (value) => {\n          const message = {\n            type: 'onChange',\n            message: value,\n          };\n          window.ReactNativeWebView.postMessage(JSON.stringify(message));\n        },\n      });\n      // 监听React Native发送来的消息\n      window.document.addEventListener('message', (e) => {\n        vditor.setValue(e.data);\n      });\n    </script>\n  </body>\n</html>\n","language":"html"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n    <meta\n      name=\"viewport\"\n      content=\"width=device-width, initial-scale=1.0, user-scalable=no\"\n    />\n    <!-- 以下文件建议放到本地使用 -->\n    <link\n      rel=\"stylesheet\"\n      href=\"https://gcore.jsdelivr.net/npm/vditor/dist/index.css\"\n    />\n    <script src=\"https://gcore.jsdelivr.net/npm/vditor/dist/index.min.js\"></script>\n  </head>\n  <body>\n    <div id=\"vditor\"></div>\n    <script>\n      // window.options 会在React Native中通过injectedJavaScriptBeforeContentLoaded注入\n      const vditor = new Vditor('vditor', {\n        ...window.options,\n        // 向编辑器输入时，通过postMessage向React Native发送消息，触发onMessage\n        input: (value) => {\n          const message = {\n            type: 'onChange',\n            message: value,\n          };\n          window.ReactNativeWebView.postMessage(JSON.stringify(message));\n        },\n      });\n      // 监听React Native发送来的消息\n      window.document.addEventListener('message', (e) => {\n        vditor.setValue(e.data);\n      });\n    </script>\n  </body>\n</html>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果是安卓开发，需要将该文件放到"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"your-project/android/app/src/main/assets/"}]},{"type":"text","value":"下，之后通过"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"{uri: 'file:///android_asset/xxxx.html'}"}]},{"type":"text","value":"引入"}]},{"type":"element","tag":"h3","props":{"id":"react-native-组件"},"children":[{"type":"text","value":"React Native 组件"}]},{"type":"element","tag":"code","props":{"code":"import React, { useRef, useState } from 'react';\nimport { WebView, WebViewMessageEvent } from 'react-native-webview';\n\nexport default function Vditor() {\n  const webviewRef = useRef < WebView > null;\n  const [content, setContent] = useState('');\n\n  // 注入到网页中的vditor配置数据\n  const options = `window.options=${JSON.stringify({\n    mode: 'ir',\n    toolbar: [],\n    outline: false,\n    debugger: false,\n    placeholder: '可使用markdown语法...',\n  })}`;\n\n  //#region 初始化编辑器内容\n  useEffect(() => {\n    const fetchData = async () => {\n      // 获取初始化的数据\n      const data = await request();\n      setContent(data);\n    };\n    fetchData();\n  }, []);\n  useEffect(() => {\n    webviewRef.current?.postMessage(content);\n  }, [content]);\n  //#endregion\n\n  const onMessage = (e: WebViewMessageEvent) => {\n    const data = JSON.parse(e.nativeEvent.data);\n    if (data.type === 'onChange') {\n      setContent(data.message);\n    }\n  };\n\n  return (\n    <WebView\n      ref={webviewRef}\n      onMessage={onMessage}\n      javaScriptEnabled\n      source={\n        Platform.OS === 'ios'\n          ? require('../../../assets/vditor.html')\n          : { uri: 'file:///android_asset/vditor.html' }\n      }\n      injectedJavaScriptBeforeContentLoaded={options}\n      style={{\n        height: Dimensions.get('window').height,\n        width: Dimensions.get('window').width,\n      }}\n    />\n  );\n}\n","language":"jsx"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"import React, { useRef, useState } from 'react';\nimport { WebView, WebViewMessageEvent } from 'react-native-webview';\n\nexport default function Vditor() {\n  const webviewRef = useRef < WebView > null;\n  const [content, setContent] = useState('');\n\n  // 注入到网页中的vditor配置数据\n  const options = `window.options=${JSON.stringify({\n    mode: 'ir',\n    toolbar: [],\n    outline: false,\n    debugger: false,\n    placeholder: '可使用markdown语法...',\n  })}`;\n\n  //#region 初始化编辑器内容\n  useEffect(() => {\n    const fetchData = async () => {\n      // 获取初始化的数据\n      const data = await request();\n      setContent(data);\n    };\n    fetchData();\n  }, []);\n  useEffect(() => {\n    webviewRef.current?.postMessage(content);\n  }, [content]);\n  //#endregion\n\n  const onMessage = (e: WebViewMessageEvent) => {\n    const data = JSON.parse(e.nativeEvent.data);\n    if (data.type === 'onChange') {\n      setContent(data.message);\n    }\n  };\n\n  return (\n    <WebView\n      ref={webviewRef}\n      onMessage={onMessage}\n      javaScriptEnabled\n      source={\n        Platform.OS === 'ios'\n          ? require('../../../assets/vditor.html')\n          : { uri: 'file:///android_asset/vditor.html' }\n      }\n      injectedJavaScriptBeforeContentLoaded={options}\n      style={{\n        height: Dimensions.get('window').height,\n        width: Dimensions.get('window').width,\n      }}\n    />\n  );\n}\n"}]}]}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"注意：React Native 中使用 WebView 必须要给他设置宽和高，不然可能会导致应用卡死"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"完整项目地址："},{"type":"element","tag":"a","props":{"href":"https://github.com/qiyuor2/rn-xnote","rel":["nofollow"]},"children":[{"type":"text","value":"qiyuor2/rn-xnote"}]}]},{"type":"element","tag":"h2","props":{"id":"参考文章"},"children":[{"type":"text","value":"参考文章"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://juejin.cn/post/6867945949788897288","rel":["nofollow"]},"children":[{"type":"text","value":"手摸手带你封装 React Native 富文本编辑器"}]}]}]}]},"date":"2021/02/17 11:31:32","tags":["React Native","WebView"],"category":"技术","summary":"最近在研究`React Native`，准备用它写一个笔记APP，但是并没有搜到很好用的编辑器插件，因此准备使用`WebView`和已有的Web端编辑器自己封装一个。","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最近在研究"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"React Native"}]},{"type":"text","value":"，准备用它写一个笔记 APP，但是并没有搜到很好用的编辑器插件，因此准备使用"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"WebView"}]},{"type":"text","value":"和已有的 Web 端编辑器自己封装一个。"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"因本人没有苹果电脑，因此只尝试安卓版本"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"完整项目地址："},{"type":"element","tag":"a","props":{"href":"https://github.com/qiyuor2/rn-xnote","rel":["nofollow"]},"children":[{"type":"text","value":"qiyuor2/rn-xnote"}]}]},{"type":"element","tag":"h2","props":{"id":"react-native-webview"},"children":[{"type":"text","value":"React Native WebView"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"WebView"}]},{"type":"text","value":"是一个能够在原生 APP 上加载 HTML 页面的组件，不过它没有提供浏览器的地址栏、导航栏等功能。在原生 APP 的开发中经常会用到。"}]},{"type":"element","tag":"h3","props":{"id":"安装"},"children":[{"type":"text","value":"安装"}]},{"type":"element","tag":"code","props":{"code":"npm install react-native-webview\n# or yarn add react-native-webview\n","language":"bash"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"npm install react-native-webview\n# or yarn add react-native-webview\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"基本使用"},"children":[{"type":"text","value":"基本使用"}]},{"type":"element","tag":"h4","props":{"id":"引入-url"},"children":[{"type":"text","value":"引入 URL"}]},{"type":"element","tag":"code","props":{"code":"import React, { Component } from 'react';\nimport { WebView } from 'react-native';\n\nexport default function MyWeb() {\n  return (\n    <WebView source={{ uri: 'https://github.com/facebook/react-native' }} />\n  );\n}\n","language":"jsx"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"import React, { Component } from 'react';\nimport { WebView } from 'react-native';\n\nexport default function MyWeb() {\n  return (\n    <WebView source={{ uri: 'https://github.com/facebook/react-native' }} />\n  );\n}\n"}]}]}]},{"type":"element","tag":"h4","props":{"id":"引入本地文件"},"children":[{"type":"text","value":"引入本地文件"}]},{"type":"element","tag":"code","props":{"code":"import React, { Component } from 'react';\nimport { WebView, Platform } from 'react-native';\n\nexport default function MyWeb() {\n  return (\n    <WebView\n      source={\n        Platform.OS === 'ios'\n          ? require('../../../assets/vditor.html')\n          : { uri: 'file:///android_asset/vditor.html' }\n      }\n    />\n  );\n}\n","language":"jsx"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"import React, { Component } from 'react';\nimport { WebView, Platform } from 'react-native';\n\nexport default function MyWeb() {\n  return (\n    <WebView\n      source={\n        Platform.OS === 'ios'\n          ? require('../../../assets/vditor.html')\n          : { uri: 'file:///android_asset/vditor.html' }\n      }\n    />\n  );\n}\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"web-和-react-native-之间的通信"},"children":[{"type":"text","value":"Web 和 React Native 之间的通信"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Web 到 React Native"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"window.ReactNativeWebView.postMessage(message)"}]},{"type":"text","value":"该方法接收一个字符串，并将该字符串发送到 React Native 中。在 React Native 中使用"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"WebView"}]},{"type":"text","value":"组件的"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"onMessage"}]},{"type":"text","value":"属性接收"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"React Native 到 Web"}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"injectedJavaScript"}]},{"type":"text","value":"向网页中注入 js"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"injectedJavaScriptBeforeContentLoaded"}]},{"type":"text","value":"在网页加载之前向网页中注入 js"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"postMessage(message)"}]},{"type":"text","value":"向网页中发送消息，与"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"window.ReactNativeWebView.postMessage(message)"}]},{"type":"text","value":"相对应。网页可以通过监听"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"message"}]},{"type":"text","value":"事件收到消息。"}]}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"更多 API 请查看"},{"type":"element","tag":"a","props":{"href":"https://reactnative.cn/docs/webview","rel":["nofollow"]},"children":[{"type":"text","value":"WebView 文档"}]}]}]},{"type":"element","tag":"h2","props":{"id":"封装-vditor"},"children":[{"type":"text","value":"封装 Vditor"}]},{"type":"element","tag":"h3","props":{"id":"准备-html-文件"},"children":[{"type":"text","value":"准备 HTML 文件"}]},{"type":"element","tag":"code","props":{"code":"<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n    <meta\n      name=\"viewport\"\n      content=\"width=device-width, initial-scale=1.0, user-scalable=no\"\n    />\n    <!-- 以下文件建议放到本地使用 -->\n    <link\n      rel=\"stylesheet\"\n      href=\"https://gcore.jsdelivr.net/npm/vditor/dist/index.css\"\n    />\n    <script src=\"https://gcore.jsdelivr.net/npm/vditor/dist/index.min.js\"></script>\n  </head>\n  <body>\n    <div id=\"vditor\"></div>\n    <script>\n      // window.options 会在React Native中通过injectedJavaScriptBeforeContentLoaded注入\n      const vditor = new Vditor('vditor', {\n        ...window.options,\n        // 向编辑器输入时，通过postMessage向React Native发送消息，触发onMessage\n        input: (value) => {\n          const message = {\n            type: 'onChange',\n            message: value,\n          };\n          window.ReactNativeWebView.postMessage(JSON.stringify(message));\n        },\n      });\n      // 监听React Native发送来的消息\n      window.document.addEventListener('message', (e) => {\n        vditor.setValue(e.data);\n      });\n    </script>\n  </body>\n</html>\n","language":"html"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n    <meta\n      name=\"viewport\"\n      content=\"width=device-width, initial-scale=1.0, user-scalable=no\"\n    />\n    <!-- 以下文件建议放到本地使用 -->\n    <link\n      rel=\"stylesheet\"\n      href=\"https://gcore.jsdelivr.net/npm/vditor/dist/index.css\"\n    />\n    <script src=\"https://gcore.jsdelivr.net/npm/vditor/dist/index.min.js\"></script>\n  </head>\n  <body>\n    <div id=\"vditor\"></div>\n    <script>\n      // window.options 会在React Native中通过injectedJavaScriptBeforeContentLoaded注入\n      const vditor = new Vditor('vditor', {\n        ...window.options,\n        // 向编辑器输入时，通过postMessage向React Native发送消息，触发onMessage\n        input: (value) => {\n          const message = {\n            type: 'onChange',\n            message: value,\n          };\n          window.ReactNativeWebView.postMessage(JSON.stringify(message));\n        },\n      });\n      // 监听React Native发送来的消息\n      window.document.addEventListener('message', (e) => {\n        vditor.setValue(e.data);\n      });\n    </script>\n  </body>\n</html>\n"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"如果是安卓开发，需要将该文件放到"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"your-project/android/app/src/main/assets/"}]},{"type":"text","value":"下，之后通过"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"{uri: 'file:///android_asset/xxxx.html'}"}]},{"type":"text","value":"引入"}]},{"type":"element","tag":"h3","props":{"id":"react-native-组件"},"children":[{"type":"text","value":"React Native 组件"}]},{"type":"element","tag":"code","props":{"code":"import React, { useRef, useState } from 'react';\nimport { WebView, WebViewMessageEvent } from 'react-native-webview';\n\nexport default function Vditor() {\n  const webviewRef = useRef < WebView > null;\n  const [content, setContent] = useState('');\n\n  // 注入到网页中的vditor配置数据\n  const options = `window.options=${JSON.stringify({\n    mode: 'ir',\n    toolbar: [],\n    outline: false,\n    debugger: false,\n    placeholder: '可使用markdown语法...',\n  })}`;\n\n  //#region 初始化编辑器内容\n  useEffect(() => {\n    const fetchData = async () => {\n      // 获取初始化的数据\n      const data = await request();\n      setContent(data);\n    };\n    fetchData();\n  }, []);\n  useEffect(() => {\n    webviewRef.current?.postMessage(content);\n  }, [content]);\n  //#endregion\n\n  const onMessage = (e: WebViewMessageEvent) => {\n    const data = JSON.parse(e.nativeEvent.data);\n    if (data.type === 'onChange') {\n      setContent(data.message);\n    }\n  };\n\n  return (\n    <WebView\n      ref={webviewRef}\n      onMessage={onMessage}\n      javaScriptEnabled\n      source={\n        Platform.OS === 'ios'\n          ? require('../../../assets/vditor.html')\n          : { uri: 'file:///android_asset/vditor.html' }\n      }\n      injectedJavaScriptBeforeContentLoaded={options}\n      style={{\n        height: Dimensions.get('window').height,\n        width: Dimensions.get('window').width,\n      }}\n    />\n  );\n}\n","language":"jsx"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"import React, { useRef, useState } from 'react';\nimport { WebView, WebViewMessageEvent } from 'react-native-webview';\n\nexport default function Vditor() {\n  const webviewRef = useRef < WebView > null;\n  const [content, setContent] = useState('');\n\n  // 注入到网页中的vditor配置数据\n  const options = `window.options=${JSON.stringify({\n    mode: 'ir',\n    toolbar: [],\n    outline: false,\n    debugger: false,\n    placeholder: '可使用markdown语法...',\n  })}`;\n\n  //#region 初始化编辑器内容\n  useEffect(() => {\n    const fetchData = async () => {\n      // 获取初始化的数据\n      const data = await request();\n      setContent(data);\n    };\n    fetchData();\n  }, []);\n  useEffect(() => {\n    webviewRef.current?.postMessage(content);\n  }, [content]);\n  //#endregion\n\n  const onMessage = (e: WebViewMessageEvent) => {\n    const data = JSON.parse(e.nativeEvent.data);\n    if (data.type === 'onChange') {\n      setContent(data.message);\n    }\n  };\n\n  return (\n    <WebView\n      ref={webviewRef}\n      onMessage={onMessage}\n      javaScriptEnabled\n      source={\n        Platform.OS === 'ios'\n          ? require('../../../assets/vditor.html')\n          : { uri: 'file:///android_asset/vditor.html' }\n      }\n      injectedJavaScriptBeforeContentLoaded={options}\n      style={{\n        height: Dimensions.get('window').height,\n        width: Dimensions.get('window').width,\n      }}\n    />\n  );\n}\n"}]}]}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"注意：React Native 中使用 WebView 必须要给他设置宽和高，不然可能会导致应用卡死"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"完整项目地址："},{"type":"element","tag":"a","props":{"href":"https://github.com/qiyuor2/rn-xnote","rel":["nofollow"]},"children":[{"type":"text","value":"qiyuor2/rn-xnote"}]}]},{"type":"element","tag":"h2","props":{"id":"参考文章"},"children":[{"type":"text","value":"参考文章"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://juejin.cn/post/6867945949788897288","rel":["nofollow"]},"children":[{"type":"text","value":"手摸手带你封装 React Native 富文本编辑器"}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"react-native-webview","depth":2,"text":"React Native WebView","children":[{"id":"安装","depth":3,"text":"安装"},{"id":"基本使用","depth":3,"text":"基本使用"},{"id":"web-和-react-native-之间的通信","depth":3,"text":"Web 和 React Native 之间的通信"}]},{"id":"封装-vditor","depth":2,"text":"封装 Vditor","children":[{"id":"准备-html-文件","depth":3,"text":"准备 HTML 文件"},{"id":"react-native-组件","depth":3,"text":"React Native 组件"}]},{"id":"参考文章","depth":2,"text":"参考文章"}]}},"_type":"markdown","_id":"content:2021:package-md-editor-for-rn.md","_source":"content","_file":"2021/package-md-editor-for-rn.md","_extension":"md"},"hash":"b0wdH3GJv3"}