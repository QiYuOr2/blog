{"parsed":{"_path":"/2019/csharp-html-agility-pack","_dir":"2019","_draft":false,"_partial":false,"_locale":"en","_empty":false,"title":"C# HtmlAgilityPack爬取静态页面","description":"最近对爬虫很感兴趣，稍微研究了一下，利用 HtmlAgilityPack 制作了一个十分简单的爬虫，这个简易爬虫只能获取静态页面的 Html","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最近对爬虫很感兴趣，稍微研究了一下，利用 HtmlAgilityPack 制作了一个十分简单的爬虫，这个简易爬虫只能获取静态页面的 Html"}]},{"type":"element","tag":"h2","props":{"id":"htmlagilitypack-简介"},"children":[{"type":"text","value":"HtmlAgilityPack 简介"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"HtmlAgilityPack 是一个解析速度十分快，并且开源的 Html 解析工具。HtmlAgilityPack 支持使用 Xpath 解析 Html，能够帮助我们解析 Html 文档就像解析 Xml 文档一样轻松、方便。"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://html-agility-pack.net","rel":["nofollow"]},"children":[{"type":"text","value":"HtmlAgilityPack 官网"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/zzzprojects/html-agility-pack","rel":["nofollow"]},"children":[{"type":"text","value":"HtmlAgilityPack 的 Github 地址"}]}]}]},{"type":"element","tag":"h2","props":{"id":"c安装-htmlagilitypack"},"children":[{"type":"text","value":"C#安装 HtmlAgilityPack"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"如果 VS 安装有 Nuget，在 Nuget 直接搜索安装即可。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"下载后解压缩后有 3 个文件，这里只需要将其中的 HtmlAgilityPack.dll、HtmlAgilityPack.xml 引入解决方案中即可使用"}]}]},{"type":"element","tag":"h2","props":{"id":"实例获取某页面图片"},"children":[{"type":"text","value":"实例(获取某页面图片)"}]},{"type":"element","tag":"h3","props":{"id":"加载-html-页面"},"children":[{"type":"text","value":"加载 HTML 页面"}]},{"type":"element","tag":"code","props":{"code":"//从网页中加载\nstring url = \"https://www.bilibili.com\";\nHtmlWeb web = new HtmlWeb();\nHtmlDocument hd = web.Load(url);\n","language":"csharp"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"//从网页中加载\nstring url = \"https://www.bilibili.com\";\nHtmlWeb web = new HtmlWeb();\nHtmlDocument hd = web.Load(url);\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"利用-webclient-写一个图片下载器"},"children":[{"type":"text","value":"利用 WebClient 写一个图片下载器"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"需要"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"using System.Net"}]},{"type":"text","value":"和"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"using System.IO"}]}]},{"type":"element","tag":"code","props":{"code":"/// <summary>\n/// 图片下载器\n/// </summary>\npublic class ImgDownloader\n{\n    /// <summary>\n    /// 下载图片\n    /// </summary>\n    /// <param name=\"webClient\"></param>\n    /// <param name=\"url\">图片url</param>\n    /// <param name=\"folderPath\">文件夹路径</param>\n    /// <param name=\"fileName\">图片名</param>\n    public static void DownloadImg(WebClient webClient, string url, string folderPath, string fileName)\n    {\n        //如果文件夹不存在，则创建一个\n        if (!Directory.Exists(folderPath))\n        {\n            Directory.CreateDirectory(folderPath);\n        }\n        //判断路径是否完整，补全不完整的路径\n        if (url.IndexOf(\"https:\") == -1 && url.IndexOf(\"http:\") == -1)\n        {\n            url = \"https:\" + url;\n        }\n        //下载图片\n        try\n        {\n            webClient.DownloadFile(url, folderPath + fileName);\n            Console.WriteLine(fileName + \"下载成功\");\n        }\n        catch (Exception ex)\n        {\n            Console.Write(ex.Message);\n            Console.WriteLine(url);\n        }\n    }\n}\n","language":"csharp"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"/// <summary>\n/// 图片下载器\n/// </summary>\npublic class ImgDownloader\n{\n    /// <summary>\n    /// 下载图片\n    /// </summary>\n    /// <param name=\"webClient\"></param>\n    /// <param name=\"url\">图片url</param>\n    /// <param name=\"folderPath\">文件夹路径</param>\n    /// <param name=\"fileName\">图片名</param>\n    public static void DownloadImg(WebClient webClient, string url, string folderPath, string fileName)\n    {\n        //如果文件夹不存在，则创建一个\n        if (!Directory.Exists(folderPath))\n        {\n            Directory.CreateDirectory(folderPath);\n        }\n        //判断路径是否完整，补全不完整的路径\n        if (url.IndexOf(\"https:\") == -1 && url.IndexOf(\"http:\") == -1)\n        {\n            url = \"https:\" + url;\n        }\n        //下载图片\n        try\n        {\n            webClient.DownloadFile(url, folderPath + fileName);\n            Console.WriteLine(fileName + \"下载成功\");\n        }\n        catch (Exception ex)\n        {\n            Console.Write(ex.Message);\n            Console.WriteLine(url);\n        }\n    }\n}\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"通过-xpath-获取-img-标签中的图片"},"children":[{"type":"text","value":"通过 Xpath 获取 img 标签中的图片"}]},{"type":"element","tag":"code","props":{"code":"string imgPath = \"//img\";//选择img\nint imgNum = 0;//图片编号\n//获取img标签中的图片\nforeach (HtmlNode node in hd.DocumentNode.SelectNodes(imgPath))\n{\n    if (node.Attributes[\"src\"] != null)\n    {\n        string imgUrl = node.Attributes[\"src\"].Value.ToString();\n        if (imgUrl != \"\" && imgUrl != \" \")\n        {\n            imgNum++;\n            //生成文件名，自动获取后缀\n            string fileName = imgNum + imgUrl.Substring(imgUrl.LastIndexOf(\".\"));\n            ImgDownloader.DownloadImg(wc, imgUrl, \"images/\", fileName);\n        }\n    }\n}\n","language":"csharp"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"string imgPath = \"//img\";//选择img\nint imgNum = 0;//图片编号\n//获取img标签中的图片\nforeach (HtmlNode node in hd.DocumentNode.SelectNodes(imgPath))\n{\n    if (node.Attributes[\"src\"] != null)\n    {\n        string imgUrl = node.Attributes[\"src\"].Value.ToString();\n        if (imgUrl != \"\" && imgUrl != \" \")\n        {\n            imgNum++;\n            //生成文件名，自动获取后缀\n            string fileName = imgNum + imgUrl.Substring(imgUrl.LastIndexOf(\".\"));\n            ImgDownloader.DownloadImg(wc, imgUrl, \"images/\", fileName);\n        }\n    }\n}\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"通过-xpath-获取背景图"},"children":[{"type":"text","value":"通过 Xpath 获取背景图"}]},{"type":"element","tag":"code","props":{"code":"//获取背景图\nstring bgImgPath = \"//*[@style]\";//选择具有style属性的节点\nforeach (HtmlNode node in hd.DocumentNode.SelectNodes(bgImgPath))\n{\n    if (node.Attributes[\"style\"].Value.Contains(\"background-image:url\"))\n    {\n        imgNum++;\n        string bgImgUrl = node.Attributes[\"style\"].Value;\n        bgImgUrl = Regex.Match(bgImgUrl, @\"(?<=\\().+?(?=\\))\").Value;//读取url()的内容\n        //Console.WriteLine(bgImgUrl);\n        //生成文件名，自动获取后缀\n        string fileName = imgNum + bgImgUrl.Substring(bgImgUrl.LastIndexOf(\".\"));\n\n        ImgDownloader.DownloadImg(wc, bgImgUrl, \"images/bgcImg/\", fileName);\n    }\n}\n","language":"csharp"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"//获取背景图\nstring bgImgPath = \"//*[@style]\";//选择具有style属性的节点\nforeach (HtmlNode node in hd.DocumentNode.SelectNodes(bgImgPath))\n{\n    if (node.Attributes[\"style\"].Value.Contains(\"background-image:url\"))\n    {\n        imgNum++;\n        string bgImgUrl = node.Attributes[\"style\"].Value;\n        bgImgUrl = Regex.Match(bgImgUrl, @\"(?<=\\().+?(?=\\))\").Value;//读取url()的内容\n        //Console.WriteLine(bgImgUrl);\n        //生成文件名，自动获取后缀\n        string fileName = imgNum + bgImgUrl.Substring(bgImgUrl.LastIndexOf(\".\"));\n\n        ImgDownloader.DownloadImg(wc, bgImgUrl, \"images/bgcImg/\", fileName);\n    }\n}\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"完整代码"},"children":[{"type":"text","value":"完整代码"}]},{"type":"element","tag":"details","props":{},"children":[{"type":"element","tag":"code","props":{"code":"using System.Linq;\nusing System.Text;\nusing System.Threading.Tasks;\nusing System.Net;\nusing System.IO;\nusing HtmlAgilityPack;\nusing System.Text.RegularExpressions;\n\nnamespace WebCrawlerDemo\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            WebClient wc = new WebClient();\n\n\n            string url = \"https://www.bilibili.com\";\n            HtmlWeb web = new HtmlWeb();\n            HtmlDocument hd = web.Load(url);//下载html页面\n\n            string imgPath = \"//img\";//选择img\n\n            int imgNum = 0;//图片编号\n\n            //获取img标签中的图片\n            foreach (HtmlNode node in hd.DocumentNode.SelectNodes(imgPath))\n            {\n                if (node.Attributes[\"src\"] != null)\n                {\n                    string imgUrl = node.Attributes[\"src\"].Value.ToString();\n                    if (imgUrl != \"\" && imgUrl != \" \")\n                    {\n                        imgNum++;\n                        //生成文件名，自动获取后缀\n                        string fileName = imgNum + imgUrl.Substring(imgUrl.LastIndexOf(\".\"));\n\n                        ImgDownloader.DownloadImg(wc, imgUrl, \"images/\", fileName);\n                    }\n                }\n            }\n            //获取背景图\n            string bgImgPath = \"//*[@style]\";//选择具有style属性的节点\n            foreach (HtmlNode node in hd.DocumentNode.SelectNodes(bgImgPath))\n            {\n                if (node.Attributes[\"style\"].Value.Contains(\"background-image:url\"))\n                {\n                    imgNum++;\n                    string bgImgUrl = node.Attributes[\"style\"].Value;\n                    bgImgUrl = Regex.Match(bgImgUrl, @\"(?<=\\().+?(?=\\))\").Value;//读取url()的内容\n                    //生成文件名，自动获取后缀\n                    string fileName = imgNum + bgImgUrl.Substring(bgImgUrl.LastIndexOf(\".\"));\n\n                    ImgDownloader.DownloadImg(wc, bgImgUrl, \"images/bgcImg/\", fileName);\n                }\n            }\n\n            Console.WriteLine(\"----------END----------\");\n            Console.ReadKey();\n        }\n    }\n    /// <summary>\n    /// 图片下载器\n    /// </summary>\n    public class ImgDownloader\n    {\n        /// <summary>\n        /// 下载图片\n        /// </summary>\n        /// <param name=\"webClient\"></param>\n        /// <param name=\"url\">图片url</param>\n        /// <param name=\"folderPath\">文件夹路径</param>\n        /// <param name=\"fileName\">图片名</param>\n        public static void DownloadImg(WebClient webClient, string url, string folderPath, string fileName)\n        {\n            //如果文件夹不存在，则创建一个\n            if (!Directory.Exists(folderPath))\n            {\n                Directory.CreateDirectory(folderPath);\n            }\n            //判断路径是否完整，补全不完整的路径\n            if (url.IndexOf(\"https:\") == -1 && url.IndexOf(\"http:\") == -1)\n            {\n                url = \"https:\" + url;\n            }\n            //下载图片\n            try\n            {\n                webClient.DownloadFile(url, folderPath + fileName);\n                Console.WriteLine(fileName + \"下载成功\");\n            }\n            catch (Exception ex)\n            {\n                Console.Write(ex.Message);\n                Console.WriteLine(url);\n            }\n        }\n    }\n}\n","language":"csharp"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"using System.Linq;\nusing System.Text;\nusing System.Threading.Tasks;\nusing System.Net;\nusing System.IO;\nusing HtmlAgilityPack;\nusing System.Text.RegularExpressions;\n\nnamespace WebCrawlerDemo\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            WebClient wc = new WebClient();\n\n\n            string url = \"https://www.bilibili.com\";\n            HtmlWeb web = new HtmlWeb();\n            HtmlDocument hd = web.Load(url);//下载html页面\n\n            string imgPath = \"//img\";//选择img\n\n            int imgNum = 0;//图片编号\n\n            //获取img标签中的图片\n            foreach (HtmlNode node in hd.DocumentNode.SelectNodes(imgPath))\n            {\n                if (node.Attributes[\"src\"] != null)\n                {\n                    string imgUrl = node.Attributes[\"src\"].Value.ToString();\n                    if (imgUrl != \"\" && imgUrl != \" \")\n                    {\n                        imgNum++;\n                        //生成文件名，自动获取后缀\n                        string fileName = imgNum + imgUrl.Substring(imgUrl.LastIndexOf(\".\"));\n\n                        ImgDownloader.DownloadImg(wc, imgUrl, \"images/\", fileName);\n                    }\n                }\n            }\n            //获取背景图\n            string bgImgPath = \"//*[@style]\";//选择具有style属性的节点\n            foreach (HtmlNode node in hd.DocumentNode.SelectNodes(bgImgPath))\n            {\n                if (node.Attributes[\"style\"].Value.Contains(\"background-image:url\"))\n                {\n                    imgNum++;\n                    string bgImgUrl = node.Attributes[\"style\"].Value;\n                    bgImgUrl = Regex.Match(bgImgUrl, @\"(?<=\\().+?(?=\\))\").Value;//读取url()的内容\n                    //生成文件名，自动获取后缀\n                    string fileName = imgNum + bgImgUrl.Substring(bgImgUrl.LastIndexOf(\".\"));\n\n                    ImgDownloader.DownloadImg(wc, bgImgUrl, \"images/bgcImg/\", fileName);\n                }\n            }\n\n            Console.WriteLine(\"----------END----------\");\n            Console.ReadKey();\n        }\n    }\n    /// <summary>\n    /// 图片下载器\n    /// </summary>\n    public class ImgDownloader\n    {\n        /// <summary>\n        /// 下载图片\n        /// </summary>\n        /// <param name=\"webClient\"></param>\n        /// <param name=\"url\">图片url</param>\n        /// <param name=\"folderPath\">文件夹路径</param>\n        /// <param name=\"fileName\">图片名</param>\n        public static void DownloadImg(WebClient webClient, string url, string folderPath, string fileName)\n        {\n            //如果文件夹不存在，则创建一个\n            if (!Directory.Exists(folderPath))\n            {\n                Directory.CreateDirectory(folderPath);\n            }\n            //判断路径是否完整，补全不完整的路径\n            if (url.IndexOf(\"https:\") == -1 && url.IndexOf(\"http:\") == -1)\n            {\n                url = \"https:\" + url;\n            }\n            //下载图片\n            try\n            {\n                webClient.DownloadFile(url, folderPath + fileName);\n                Console.WriteLine(fileName + \"下载成功\");\n            }\n            catch (Exception ex)\n            {\n                Console.Write(ex.Message);\n                Console.WriteLine(url);\n            }\n        }\n    }\n}\n"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"参考文章"},"children":[{"type":"text","value":"参考文章"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.cnblogs.com/xuliangxing/p/8004403.html","rel":["nofollow"]},"children":[{"type":"text","value":"C#网络爬虫利器之 HtmlAgilityPack 如何快速实现解析 Html"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://blog.csdn.net/Ylcacsdn/article/details/78314297","rel":["nofollow"]},"children":[{"type":"text","value":".Net 解析 html 文档使用类库 HtmlAgilityPack"}]}]}]}]},"date":"2019/09/04 22:10:24","tags":["CSharp","Web Crawler"],"category":"技术","summary":"最近对爬虫很感兴趣，稍微研究了一下，利用HtmlAgilityPack制作了一个十分简单的爬虫，这个简易爬虫只能获取静态页面的Html...","body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最近对爬虫很感兴趣，稍微研究了一下，利用 HtmlAgilityPack 制作了一个十分简单的爬虫，这个简易爬虫只能获取静态页面的 Html"}]},{"type":"element","tag":"h2","props":{"id":"htmlagilitypack-简介"},"children":[{"type":"text","value":"HtmlAgilityPack 简介"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"HtmlAgilityPack 是一个解析速度十分快，并且开源的 Html 解析工具。HtmlAgilityPack 支持使用 Xpath 解析 Html，能够帮助我们解析 Html 文档就像解析 Xml 文档一样轻松、方便。"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://html-agility-pack.net","rel":["nofollow"]},"children":[{"type":"text","value":"HtmlAgilityPack 官网"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/zzzprojects/html-agility-pack","rel":["nofollow"]},"children":[{"type":"text","value":"HtmlAgilityPack 的 Github 地址"}]}]}]},{"type":"element","tag":"h2","props":{"id":"c安装-htmlagilitypack"},"children":[{"type":"text","value":"C#安装 HtmlAgilityPack"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"如果 VS 安装有 Nuget，在 Nuget 直接搜索安装即可。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"下载后解压缩后有 3 个文件，这里只需要将其中的 HtmlAgilityPack.dll、HtmlAgilityPack.xml 引入解决方案中即可使用"}]}]},{"type":"element","tag":"h2","props":{"id":"实例获取某页面图片"},"children":[{"type":"text","value":"实例(获取某页面图片)"}]},{"type":"element","tag":"h3","props":{"id":"加载-html-页面"},"children":[{"type":"text","value":"加载 HTML 页面"}]},{"type":"element","tag":"code","props":{"code":"//从网页中加载\nstring url = \"https://www.bilibili.com\";\nHtmlWeb web = new HtmlWeb();\nHtmlDocument hd = web.Load(url);\n","language":"csharp"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"//从网页中加载\nstring url = \"https://www.bilibili.com\";\nHtmlWeb web = new HtmlWeb();\nHtmlDocument hd = web.Load(url);\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"利用-webclient-写一个图片下载器"},"children":[{"type":"text","value":"利用 WebClient 写一个图片下载器"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"需要"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"using System.Net"}]},{"type":"text","value":"和"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"using System.IO"}]}]},{"type":"element","tag":"code","props":{"code":"/// <summary>\n/// 图片下载器\n/// </summary>\npublic class ImgDownloader\n{\n    /// <summary>\n    /// 下载图片\n    /// </summary>\n    /// <param name=\"webClient\"></param>\n    /// <param name=\"url\">图片url</param>\n    /// <param name=\"folderPath\">文件夹路径</param>\n    /// <param name=\"fileName\">图片名</param>\n    public static void DownloadImg(WebClient webClient, string url, string folderPath, string fileName)\n    {\n        //如果文件夹不存在，则创建一个\n        if (!Directory.Exists(folderPath))\n        {\n            Directory.CreateDirectory(folderPath);\n        }\n        //判断路径是否完整，补全不完整的路径\n        if (url.IndexOf(\"https:\") == -1 && url.IndexOf(\"http:\") == -1)\n        {\n            url = \"https:\" + url;\n        }\n        //下载图片\n        try\n        {\n            webClient.DownloadFile(url, folderPath + fileName);\n            Console.WriteLine(fileName + \"下载成功\");\n        }\n        catch (Exception ex)\n        {\n            Console.Write(ex.Message);\n            Console.WriteLine(url);\n        }\n    }\n}\n","language":"csharp"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"/// <summary>\n/// 图片下载器\n/// </summary>\npublic class ImgDownloader\n{\n    /// <summary>\n    /// 下载图片\n    /// </summary>\n    /// <param name=\"webClient\"></param>\n    /// <param name=\"url\">图片url</param>\n    /// <param name=\"folderPath\">文件夹路径</param>\n    /// <param name=\"fileName\">图片名</param>\n    public static void DownloadImg(WebClient webClient, string url, string folderPath, string fileName)\n    {\n        //如果文件夹不存在，则创建一个\n        if (!Directory.Exists(folderPath))\n        {\n            Directory.CreateDirectory(folderPath);\n        }\n        //判断路径是否完整，补全不完整的路径\n        if (url.IndexOf(\"https:\") == -1 && url.IndexOf(\"http:\") == -1)\n        {\n            url = \"https:\" + url;\n        }\n        //下载图片\n        try\n        {\n            webClient.DownloadFile(url, folderPath + fileName);\n            Console.WriteLine(fileName + \"下载成功\");\n        }\n        catch (Exception ex)\n        {\n            Console.Write(ex.Message);\n            Console.WriteLine(url);\n        }\n    }\n}\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"通过-xpath-获取-img-标签中的图片"},"children":[{"type":"text","value":"通过 Xpath 获取 img 标签中的图片"}]},{"type":"element","tag":"code","props":{"code":"string imgPath = \"//img\";//选择img\nint imgNum = 0;//图片编号\n//获取img标签中的图片\nforeach (HtmlNode node in hd.DocumentNode.SelectNodes(imgPath))\n{\n    if (node.Attributes[\"src\"] != null)\n    {\n        string imgUrl = node.Attributes[\"src\"].Value.ToString();\n        if (imgUrl != \"\" && imgUrl != \" \")\n        {\n            imgNum++;\n            //生成文件名，自动获取后缀\n            string fileName = imgNum + imgUrl.Substring(imgUrl.LastIndexOf(\".\"));\n            ImgDownloader.DownloadImg(wc, imgUrl, \"images/\", fileName);\n        }\n    }\n}\n","language":"csharp"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"string imgPath = \"//img\";//选择img\nint imgNum = 0;//图片编号\n//获取img标签中的图片\nforeach (HtmlNode node in hd.DocumentNode.SelectNodes(imgPath))\n{\n    if (node.Attributes[\"src\"] != null)\n    {\n        string imgUrl = node.Attributes[\"src\"].Value.ToString();\n        if (imgUrl != \"\" && imgUrl != \" \")\n        {\n            imgNum++;\n            //生成文件名，自动获取后缀\n            string fileName = imgNum + imgUrl.Substring(imgUrl.LastIndexOf(\".\"));\n            ImgDownloader.DownloadImg(wc, imgUrl, \"images/\", fileName);\n        }\n    }\n}\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"通过-xpath-获取背景图"},"children":[{"type":"text","value":"通过 Xpath 获取背景图"}]},{"type":"element","tag":"code","props":{"code":"//获取背景图\nstring bgImgPath = \"//*[@style]\";//选择具有style属性的节点\nforeach (HtmlNode node in hd.DocumentNode.SelectNodes(bgImgPath))\n{\n    if (node.Attributes[\"style\"].Value.Contains(\"background-image:url\"))\n    {\n        imgNum++;\n        string bgImgUrl = node.Attributes[\"style\"].Value;\n        bgImgUrl = Regex.Match(bgImgUrl, @\"(?<=\\().+?(?=\\))\").Value;//读取url()的内容\n        //Console.WriteLine(bgImgUrl);\n        //生成文件名，自动获取后缀\n        string fileName = imgNum + bgImgUrl.Substring(bgImgUrl.LastIndexOf(\".\"));\n\n        ImgDownloader.DownloadImg(wc, bgImgUrl, \"images/bgcImg/\", fileName);\n    }\n}\n","language":"csharp"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"//获取背景图\nstring bgImgPath = \"//*[@style]\";//选择具有style属性的节点\nforeach (HtmlNode node in hd.DocumentNode.SelectNodes(bgImgPath))\n{\n    if (node.Attributes[\"style\"].Value.Contains(\"background-image:url\"))\n    {\n        imgNum++;\n        string bgImgUrl = node.Attributes[\"style\"].Value;\n        bgImgUrl = Regex.Match(bgImgUrl, @\"(?<=\\().+?(?=\\))\").Value;//读取url()的内容\n        //Console.WriteLine(bgImgUrl);\n        //生成文件名，自动获取后缀\n        string fileName = imgNum + bgImgUrl.Substring(bgImgUrl.LastIndexOf(\".\"));\n\n        ImgDownloader.DownloadImg(wc, bgImgUrl, \"images/bgcImg/\", fileName);\n    }\n}\n"}]}]}]},{"type":"element","tag":"h3","props":{"id":"完整代码"},"children":[{"type":"text","value":"完整代码"}]},{"type":"element","tag":"details","props":{},"children":[{"type":"element","tag":"code","props":{"code":"using System.Linq;\nusing System.Text;\nusing System.Threading.Tasks;\nusing System.Net;\nusing System.IO;\nusing HtmlAgilityPack;\nusing System.Text.RegularExpressions;\n\nnamespace WebCrawlerDemo\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            WebClient wc = new WebClient();\n\n\n            string url = \"https://www.bilibili.com\";\n            HtmlWeb web = new HtmlWeb();\n            HtmlDocument hd = web.Load(url);//下载html页面\n\n            string imgPath = \"//img\";//选择img\n\n            int imgNum = 0;//图片编号\n\n            //获取img标签中的图片\n            foreach (HtmlNode node in hd.DocumentNode.SelectNodes(imgPath))\n            {\n                if (node.Attributes[\"src\"] != null)\n                {\n                    string imgUrl = node.Attributes[\"src\"].Value.ToString();\n                    if (imgUrl != \"\" && imgUrl != \" \")\n                    {\n                        imgNum++;\n                        //生成文件名，自动获取后缀\n                        string fileName = imgNum + imgUrl.Substring(imgUrl.LastIndexOf(\".\"));\n\n                        ImgDownloader.DownloadImg(wc, imgUrl, \"images/\", fileName);\n                    }\n                }\n            }\n            //获取背景图\n            string bgImgPath = \"//*[@style]\";//选择具有style属性的节点\n            foreach (HtmlNode node in hd.DocumentNode.SelectNodes(bgImgPath))\n            {\n                if (node.Attributes[\"style\"].Value.Contains(\"background-image:url\"))\n                {\n                    imgNum++;\n                    string bgImgUrl = node.Attributes[\"style\"].Value;\n                    bgImgUrl = Regex.Match(bgImgUrl, @\"(?<=\\().+?(?=\\))\").Value;//读取url()的内容\n                    //生成文件名，自动获取后缀\n                    string fileName = imgNum + bgImgUrl.Substring(bgImgUrl.LastIndexOf(\".\"));\n\n                    ImgDownloader.DownloadImg(wc, bgImgUrl, \"images/bgcImg/\", fileName);\n                }\n            }\n\n            Console.WriteLine(\"----------END----------\");\n            Console.ReadKey();\n        }\n    }\n    /// <summary>\n    /// 图片下载器\n    /// </summary>\n    public class ImgDownloader\n    {\n        /// <summary>\n        /// 下载图片\n        /// </summary>\n        /// <param name=\"webClient\"></param>\n        /// <param name=\"url\">图片url</param>\n        /// <param name=\"folderPath\">文件夹路径</param>\n        /// <param name=\"fileName\">图片名</param>\n        public static void DownloadImg(WebClient webClient, string url, string folderPath, string fileName)\n        {\n            //如果文件夹不存在，则创建一个\n            if (!Directory.Exists(folderPath))\n            {\n                Directory.CreateDirectory(folderPath);\n            }\n            //判断路径是否完整，补全不完整的路径\n            if (url.IndexOf(\"https:\") == -1 && url.IndexOf(\"http:\") == -1)\n            {\n                url = \"https:\" + url;\n            }\n            //下载图片\n            try\n            {\n                webClient.DownloadFile(url, folderPath + fileName);\n                Console.WriteLine(fileName + \"下载成功\");\n            }\n            catch (Exception ex)\n            {\n                Console.Write(ex.Message);\n                Console.WriteLine(url);\n            }\n        }\n    }\n}\n","language":"csharp"},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"using System.Linq;\nusing System.Text;\nusing System.Threading.Tasks;\nusing System.Net;\nusing System.IO;\nusing HtmlAgilityPack;\nusing System.Text.RegularExpressions;\n\nnamespace WebCrawlerDemo\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            WebClient wc = new WebClient();\n\n\n            string url = \"https://www.bilibili.com\";\n            HtmlWeb web = new HtmlWeb();\n            HtmlDocument hd = web.Load(url);//下载html页面\n\n            string imgPath = \"//img\";//选择img\n\n            int imgNum = 0;//图片编号\n\n            //获取img标签中的图片\n            foreach (HtmlNode node in hd.DocumentNode.SelectNodes(imgPath))\n            {\n                if (node.Attributes[\"src\"] != null)\n                {\n                    string imgUrl = node.Attributes[\"src\"].Value.ToString();\n                    if (imgUrl != \"\" && imgUrl != \" \")\n                    {\n                        imgNum++;\n                        //生成文件名，自动获取后缀\n                        string fileName = imgNum + imgUrl.Substring(imgUrl.LastIndexOf(\".\"));\n\n                        ImgDownloader.DownloadImg(wc, imgUrl, \"images/\", fileName);\n                    }\n                }\n            }\n            //获取背景图\n            string bgImgPath = \"//*[@style]\";//选择具有style属性的节点\n            foreach (HtmlNode node in hd.DocumentNode.SelectNodes(bgImgPath))\n            {\n                if (node.Attributes[\"style\"].Value.Contains(\"background-image:url\"))\n                {\n                    imgNum++;\n                    string bgImgUrl = node.Attributes[\"style\"].Value;\n                    bgImgUrl = Regex.Match(bgImgUrl, @\"(?<=\\().+?(?=\\))\").Value;//读取url()的内容\n                    //生成文件名，自动获取后缀\n                    string fileName = imgNum + bgImgUrl.Substring(bgImgUrl.LastIndexOf(\".\"));\n\n                    ImgDownloader.DownloadImg(wc, bgImgUrl, \"images/bgcImg/\", fileName);\n                }\n            }\n\n            Console.WriteLine(\"----------END----------\");\n            Console.ReadKey();\n        }\n    }\n    /// <summary>\n    /// 图片下载器\n    /// </summary>\n    public class ImgDownloader\n    {\n        /// <summary>\n        /// 下载图片\n        /// </summary>\n        /// <param name=\"webClient\"></param>\n        /// <param name=\"url\">图片url</param>\n        /// <param name=\"folderPath\">文件夹路径</param>\n        /// <param name=\"fileName\">图片名</param>\n        public static void DownloadImg(WebClient webClient, string url, string folderPath, string fileName)\n        {\n            //如果文件夹不存在，则创建一个\n            if (!Directory.Exists(folderPath))\n            {\n                Directory.CreateDirectory(folderPath);\n            }\n            //判断路径是否完整，补全不完整的路径\n            if (url.IndexOf(\"https:\") == -1 && url.IndexOf(\"http:\") == -1)\n            {\n                url = \"https:\" + url;\n            }\n            //下载图片\n            try\n            {\n                webClient.DownloadFile(url, folderPath + fileName);\n                Console.WriteLine(fileName + \"下载成功\");\n            }\n            catch (Exception ex)\n            {\n                Console.Write(ex.Message);\n                Console.WriteLine(url);\n            }\n        }\n    }\n}\n"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"参考文章"},"children":[{"type":"text","value":"参考文章"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.cnblogs.com/xuliangxing/p/8004403.html","rel":["nofollow"]},"children":[{"type":"text","value":"C#网络爬虫利器之 HtmlAgilityPack 如何快速实现解析 Html"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://blog.csdn.net/Ylcacsdn/article/details/78314297","rel":["nofollow"]},"children":[{"type":"text","value":".Net 解析 html 文档使用类库 HtmlAgilityPack"}]}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"htmlagilitypack-简介","depth":2,"text":"HtmlAgilityPack 简介"},{"id":"c安装-htmlagilitypack","depth":2,"text":"C#安装 HtmlAgilityPack"},{"id":"实例获取某页面图片","depth":2,"text":"实例(获取某页面图片)","children":[{"id":"加载-html-页面","depth":3,"text":"加载 HTML 页面"},{"id":"利用-webclient-写一个图片下载器","depth":3,"text":"利用 WebClient 写一个图片下载器"},{"id":"通过-xpath-获取-img-标签中的图片","depth":3,"text":"通过 Xpath 获取 img 标签中的图片"},{"id":"通过-xpath-获取背景图","depth":3,"text":"通过 Xpath 获取背景图"},{"id":"完整代码","depth":3,"text":"完整代码"}]},{"id":"参考文章","depth":2,"text":"参考文章"}]}},"_type":"markdown","_id":"content:2019:csharp-html-agility-pack.md","_source":"content","_file":"2019/csharp-html-agility-pack.md","_extension":"md"},"hash":"tzg6yFwJoB"}